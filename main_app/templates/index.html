{% extends "base.html" %}
{% block content %}
<div class="row">
    <div class="column">
        <div class='result'>
            <!-- Search bar-->
            <form id="search-clinic-form" method="post">
                {% csrf_token %}
                <input required type="text" autocomplete="off" name="search_item" class='search-bar' placeholder="Search place, clinic name, or item" id="searchItem" onkeyup="suggestSearch()"> 
                <input type="submit" class="search-button">
            </form>
            <!--RESULT-->
            <div class='preview'>
                <br>
                <h3 align='center'>Available Clinics</h3>
                <form id="indexForm" method='post' enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="hidden" id="id_field">
                    <input type="submit" hidden>
                    </form>
                {% for values in user_data %}
                <!-- {% if time|time:"g:i A" < values.closing_time or values.opening_time < time|time:"g:i A" %} -->
                <div class="preview-item" onclick="showModal('{{values.clinic_name}}', '{{values.clinic_img_url}}', '{{values.clinic_address}}', '{{values.user_id}}', '{{values.clinic_description}}', '{{values.opening_time}}', '{{values.closing_time}}', '{{values.clinic_contact_number}}') " >
                   
                    <img src="{{values.clinic_img_url}}" alt="image">
                    <div class="details">
                        {{values.clinic_name}}
                        <br>
                        <img src="../static/images/rate.png" alt="" class="rate">
                        <img src="../static/images/rate.png" alt="" class="rate">
                        <img src="../static/images/rate.png" alt="" class="rate">
                        <img src="../static/images/rate.png" alt="" class="rate">
                        <img src="../static/images/rate.png" alt="" class="rate">
                        <br>
                        <br>
                        <p>{{values.clinic_address}}</p>
                        
                    </div>
                </div>
                <!-- {% endif %} -->
                {% endfor %}

            </div>
            </div>

    </div>
    <div class="column">
        <div class='map'>
            {% autoescape off %}
                {{map}}
            {% endautoescape %}
        </div>
    </div>
  </div>
<div class="grey"></div>
  <div class="item-modal">
    <img src="../static/images/map.jpg" id="item-modal-img" alt="image">
    <div class="details">
        <b><p id="item-modal-name"></p></b>
        <br>
        <img src="../static/images/rate.png" alt="" class="rate">
        <img src="../static/images/rate.png" alt="" class="rate">
        <img src="../static/images/rate.png" alt="" class="rate">
        <img src="../static/images/rate.png" alt="" class="rate">
        <img src="../static/images/rate.png" alt="" class="rate">
        <br>
        5.0
        <br>
        <br>
        <p id="item-modal-address"></p>
        <p id="item-modal-closingHours" style="font-size: 14px;"><strong>Opening and Closing time</strong></p><!--Dito ilalagay yung open and closing time-->
        <p id="item-modal-description" style="font-size: 14px;"><em>Description here</em></p><!--Dito ilalagay yung description-->
        <p id="item-modal-contact" style="font-size: 12px;"><b>Contact number</b></p>
        <p id="item-modal-user-id" style="font-size: 12px;"><b>user id</b></p>
        <!-- Button trigger modal -->
        <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#exampleModal" style="background-color: #B85C38; color: white;" onclick="showBookAppointment()">
            Book appointment
        </button>
        <p align='left' style="font-size: 12px;">Available Items</p>
        <div id="loading"></div>
        <div class="available-item">
            <!-- Available item design -->
            <!-- <div class="item">
                <img src="../static/images/map.jpg" alt="image">
                <div class="details">
                    <b>Product name</b>
                    <br>
                    Stocks: 0
                </div>
            </div> -->
            
        </div>
        

    </div>
    <br>
    <a href="#"><em>Rate</em></a> this clinic. <em style="font-size: 12px;">(This feature is disabled)</em>
  </div>

  <div class="search-modal">
      <!-- Search result item-->
      
      <!-- <div class="search-result">
        <img src="../static/images/map.jpg" alt="">
        <div class="details">
            Clinic name
            <br>
            Rate
            <br>
            <br>
            Location
        </div> -->
    </div>
    
  </div>

 <!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <form action="/addAppointment/" method="post">
                {% csrf_token %}
                <div class="mb-3">
                  <label for="exampleInputEmail1" class="form-label">Full Name</label>
                  <input type="text" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" required>
                </div>
                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Email</label>
                    <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" required>
                  </div>
                  <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Date appointment</label>
                    <input type="date" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" required>
                  </div>
                  <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Time appointment</label>
                    <input type="time" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" required>
                  </div>
                  <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Phone Number</label>
                    <input type="number" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" required>
                    <div id="emailHelp" class="form-text">We'll never share your email with anyone else.</div>
                  </div>
                        
                  <input type="text" name="user_id" id="user_id_appointment" />
                <button type="submit" class="btn btn-primary">Book Appointment</button>
              </form>
        </div>
      </div>
    </div>
  </div>

  <script>
function showBookAppointment(){
    clinic_id_appointment = $('#item-modal-user-id').text();
  $('#user_id_appointment').val(clinic_id_appointment);
  window.console.log("Hello world");
  console.log("APPOINTMENT!!!!!!!");
  }



$('#loading').hide();
$( ".search-modal" ).hide();

setInterval(function(){ 
    if(!$("#searchItem").is(":focus")){
        $( ".search-result" ).remove();
        $( ".search-modal" ).hide();
    }

}, 
1000);




function show_menu(){
    $('.menu-list').show();
}
function close_menu(){
    $('.menu-list').hide();
}

$('#search-clinic-form').on('submit', function(e){
    e.preventDefault();
    $( ".preview-item" ).remove();
    console.log("1");
    $.ajax({
        type: 'post',
        url: "/search_clinic/",
        data: {
            search_item: $('#searchItem').val(),
            csrfmiddlewaretoken: $("input[name='csrfmiddlewaretoken']").val(),
          },
        success: function(data){
            $( ".preview-item" ).remove();
            $('.preview').append(data);
        },
        error: function(data){
            alert('have an error');
        },
  
    });
});




function suggestSearch(){
    $( ".search-result" ).remove();
    $( ".search-modal" ).show();

        if( $('#searchItem').val() == ""){
            $( ".search-result" ).remove();
            $( ".search-modal" ).hide();
        }
        else{
            $.post({
                type: 'post',
                url: "/getSearchData/",
                data: {
                    search_item: $('#searchItem').val(),
                    csrfmiddlewaretoken: $("input[name='csrfmiddlewaretoken']").val(),
                },
                success: function(data){
                $( ".search-result" ).remove();

                },
                error: function(data){
                    alert(data + 'have an error');
                },

            })
            .done(function(data){
                $('.search-modal').append(data);

                notFound = "<p class=\"search-not-found\"> Not Found! </p>";
                if($('.search-result').length)
                {
                    $( ".search-not-found" ).remove();
                }
                else{
                    $( ".search-not-found" ).remove();
                    $('.search-modal').append(notFound);
                }
            });
        }

}

function showModal(clinic_name, img_url, clinic_address, clicked_id , clinic_description, opening, closing,number){
    $('.item-modal').show();
    $('.grey').show();

    $('#loading').show();

    $("#item-modal-img").attr("src",img_url);

    $('#item-modal-name').text(clinic_name);

    $('#item-modal-address').text(clinic_address);

    $('#item-modal-description').text(clinic_description);
    
    $('#item-modal-closingHours').text(opening + ' - ' + closing);

    $('#item-modal-contact').text(number);

    $('#item-modal-user-id').text(clicked_id);
    
    formId = '#' + clicked_id;
    $('#id_field').val(clicked_id)



    
    $.post({
        type: 'post',
        url: "",
        data: {
            user_id_post: $('#id_field').val(),
            csrfmiddlewaretoken: $("input[name='csrfmiddlewaretoken']").val(),
        },
        success: function(data){
            

        },
        error: function(data){
            alert(data + 'have an error');
        },

    })
    .done(function(data){
        //console.log(data);
        $('#loading').hide();
        $( ".item" ).remove();
        $('.available-item').append(data);
    });



    // $('#indexForm').submit(function (e){
    //     e.preventDefault();
    //     console.log("1");
    //     $.post({
    //         type: 'post',
    //         url: "/getItemData/",
    //         data: {
    //             user_id_post: $('#id_field').val(),
    //             csrfmiddlewaretoken: $("input[name='csrfmiddlewaretoken']").val(),
    //         },
    //         success: function(data){
                

    //         },
    //         error: function(data){
    //             alert(data + 'have an error');
    //         },
    
    //     })
    //     .done(function(data){
    //         data = JSON.parse(data);
    //         console.log(data["item_1"]['product_price'])
    //         return;
    //     });
    // })

        //$('#indexForm').submit();


}

if($('.item-modal:visible').length == 0)
{
    $('.grey').click(function (event) 
    {
       
           if(!$(event.target).closest('.item-modal').length && !$(event.target).is('.item-modal')) {
             $(".item-modal").hide();
             $(".grey").hide();
             	
             $( ".item" ).remove();
           }     
    });
}
else{
    
}





  </script>

{% endblock content %}